<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bounce Experiment</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script> <!-- Link to JavaScript for interactivity -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="timer-steps.js"></script>
</head>
<body class="experiment-bg">
  <!-- Start Button at the Top -->
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="usefullinks.html">Useful Links</a>
      <a href="experiment.html">Experiment</a>
      <a href="contact.html">Contact</a>
      <a href="feedback.html">Feedback</a>
    </nav>
  </header>
  <main>
    <section class="experiment-section" id="introduction">
      <h2>Introduction</h2>
      <p>Hi Team, we need to work out what inflation does to the ball, and to help our players find a good amount of inflation for the big game.</p>
      <img src="footballKick.jpg" alt="Introduction Image" class="kick-img" />
      <button id="timer-btn-intro" class="timer-btn" data-timer="600" onclick="startCountdown(this)">10 Minutes</button>
      <h3>Experiment Outline</h3>
      <iframe src="https://www.youtube.com/embed/-DGznCy4ho4" title="Experiment Outline Video" allowfullscreen></iframe>
      <button onclick="toggleDropdown('script-intro')">Show Script</button>
      <div id="script-intro" class="dropdown-content" style="display: none;">
        <p>Hi Team, great to see you here. We have a problem, and I need your help investigating the solution.</p>
        <p>The league is introducing a new type of football, and our players have been reporting that the inflation of their football is changing the way that they play. We need to work out what inflation does to the ball, and to help our players find a good amount of inflation for the big game.</p>
        <p>In the home changing rooms you should find some balls that have been inflated, can you test which of them have the best bounce? We also want to know if we can help our players out by playing on the astroturf or on a harder surface, can you investigate if this makes a difference?</p>
        <p>The drill for this experiment is, hold the ball out at chest level, drop it and count the number of bounces.</p>
        <p>We’re looking for clean data, so throwing it at the ground is going to make it hard to see if we’re measuring the strength of your arms or the bounciness of the ball.</p>
        <p>We’re going for 5 reps of this drill on each of the inflated balls. Hold the ball out at chest level, drop it and count the number of bounces.</p>
        <p>The drill is going to require some teamwork. Someone to drop the ball, some team members to count the number of bounces and someone to write down the score. Let’s work together and find out what the best surface, and best inflation is.</p>
      </div>
    </section>

    <section class="experiment-section" id="active-experiment">
      <h2>Active Experiment</h2>
      <p>Follow the steps below to conduct the experiment on each surface.</p>
      <p>We’re going to do this drill 5 times. Our average will be the most common number of bounces. Circle which ball and surface you are using. Remember to write your scores down.</p>
      <img src="instruction.png" alt="Instruction Image" class="instruction-img" />
      <p>Spend 5 minutes collecting data on each surface for two balls. Once you have collected the datapoints write down the mean average and move to the next surface. The 5 minute timer is for each surface, if you finish a surface early - no worries just restart the timer.</p>
      <button id="timer-btn-active" class="timer-btn" data-timer="300" onclick="startCountdown(this)">5 Minutes</button>
      <!-- Data Table -->
        <h3>Data Table</h3>
        <p>Use the dropdowns to select the inflation of the ball and the surface you used. Then enter the number of bounces you counted.</p>
        <table id="data-table">
            <thead>
                <tr>
                    <th>Football Inflation</th>
                    <th>Surface</th>
                    <th>Number of Bounces</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                  <td>
                    <select class="pressure-input">
                      <option value="A">A: Soft</option>
                      <option value="B">B: Hard</option>
                    </select>
                  </td>
                  <td>
                    <select class="surface-input">
                      <option value="Hard Floor">Hard Floor</option>
                      <option value="Astroturf">Astroturf</option>
                      <option value="Grass">Grass</option>
                      <option value="Carpet">Carpet</option>
                      <option value="Concrete">Concrete</option>
                    </select>
                  </td>
                  <td><input type="number" class="bounces-input" placeholder="Enter bounces"></td>
                  <td><button type="button" class="delete-row-btn" onclick="deleteRow(this)" title="Delete row">&times;</button></td>
                </tr>
                <!-- Add more rows as needed -->
            </tbody>
        </table>
        <button onclick="addRow()">Add Row</button>
        <button type="button" onclick="prePopulateData()">Pre-populate Data</button>
    </section>

    <section class="experiment-section" id="graph-plotting">
      <h2>Graph Plotting</h2>
      <p>Now that you have collected your data, it’s time to plot it on a graph. Use the data you collected to plot the number of bounces against the inflation of the ball.</p>
      <button id="timer-btn-graph" class="timer-btn" data-timer="300" onclick="startCountdown(this)">5 Minutes</button>
      <!-- Graph -->
        <h3>Graph</h3>
        <button onclick="updateGraph()">Update Graph</button>
        <canvas id="graphCanvas" width="600" height="400"></canvas>
    </section>

    <!-- Conclusions Questions Section -->
    <section class="experiment-section" id="discussion">
    <p>Take 5 minutes to discuss the below questions in your groups.</p>
    <button id="timer-btn-discussion" class="timer-btn" data-timer="300" onclick="startCountdown(this)">5 Minutes</button>
      <h2>Questions</h2>
      <img src="wordcloud.png" alt="Wordcloud" class="wordcloud-img" />
      <div>
        <p>Explain how the inflation of the ball effects the number of bounces? Can you predict which ball would be best to score a penalty with? Explain your answer.</p>
        <button onclick="toggleDropdown('answer1')">Show Answer</button>
        <div id="answer1" class="dropdown-content" style="display: none;">
          <p>We found that the less air a ball has inside it, the fewer times it bounces. 
            This is because a ball with less air is softer and changes shape more easily, which means it loses more energy when it hits the ground.
            We also noticed that there’s a big difference in how the ball bounces when it goes from no air to some air. 
            But when you go from a medium amount of air to a lot of air, the difference in bounces isn’t as big.
            If you were trying to score a penalty, the best ball to use would be the one with the most air in it. 
            This is because a harder ball doesn’t change shape as much, so more of the energy from your kick goes into making the ball move forward instead of being lost.</p>
        </div>
      </div>
      <div>
        <p>Sketch what happens to the ball when it hits the ground. Why do you think this happens?</p>
        <button onclick="toggleDropdown('answer2')">Show Answer</button>
        <div id="answer2" class="dropdown-content" style="display: none;">
          <img src="BouncingPhysics.svg" alt="Diagram describing the motion of the bouncing ball." style="max-width: 100%; height: auto;">
        </div>
      </div>
      <div>
        <p>Why do you think the surface changes how much the ball bounces? What surface do you think the team should play on?</p>
        <button onclick="toggleDropdown('answer3')">Show Answer</button>
        <div id="answer3" class="dropdown-content" style="display: none;">
          <p>The surface changes how much the ball bounces because a softer surface absorbs more energy from the ball when it hits the ground. 
            This means that less energy is available to make the ball bounce back up. 
            The team should play on a harder surface, like the changing room floor, because it will give the ball more bounce and help them score more goals.</p>
        </div>
      </div>
    </section>

    <!-- Conclusions Section -->
    <section class="experiment-section" id="conclusions">
      <h2>Theory and Conclusions</h2>
      <iframe src="https://www.youtube.com/embed/W3nrIxYmzpA" title="Conclusions Video" allowfullscreen></iframe>
      <button onclick="toggleDropdown('script-conclusion')">Show Script</button>
      <div id="script-conclusion" class="dropdown-content" style="display: none;">
        <p>Look, the team left everything out there today. They worked incredibly hard to gather this data, and in the end, that effort really paid off. 
        <p>What we’ve found is that there’s definitely a relationship between the ball’s pressure and how many times it bounces. On top of that, the surface it hits also plays a huge role in how the ball behaves.</p>
        <p>Think of it like this: As soon as you let it go of the ball, gravity takes over, and that energy shifts to movement energy because the ball is now falling. Then, you’ve got the first impact. The ball hits the ground and changes shape slightly. Energy is stored in this squashed shape, but the ball wants to snap back to shape, and that’s when the rebound happens.</p> 
        <p>But not all the energy goes into the bounce. Some is lost as sound (we hear the bounce), some as heat from friction, and some is lost when the ball is slightly damaged or changed – that’s why balls eventually wear out.</p>
        <p>As the ball goes back up, gravity slows it down, and then it starts falling again for the next bounce. But the ball doesn’t bounce forever. Each time it loses a bit of energy, so the bounces get lower and lower.</p>
        <p>Now, if we bounce the ball on a soft surface, like astroturf, it doesn’t bounce as much. That’s because both the ball and the ground change shape more, and more energy is lost. This also happens with a ball that isn’t very well inflated – it’s softer and changes shape more easily, so it loses more energy and doesn’t bounce as much.</p>
        <p>We also thought about which ball would be best for scoring a penalty. The answer? The hardest, most inflated ball. That’s because a hard ball doesn’t squash as much when you kick it, so more of your energy goes into moving the ball forward.</p>
        <p>It’s a great insight for the squad – not just about physics, but about the importance of pressure and conditions. We’ll definitely be taking this into account moving forward.</p>
      </div>
    </section>

  </main>
  <section class="experiment-section" id="extension-task-section" style="max-width:700px; margin:40px auto;">
    <h2>Extension Task</h2>
    <p>We collect data so that we can learn from it. One of the best ways to look at what the data is showing is to plot a graph, just like we did with a line graph earlier.</p>
    <p>Another way to look at the data is to use a bar chart. This can help us to compare the different categories we have been investigating.</p>
    <p>Can you sketch a bar chart using the axes below</p>
    <canvas id="barChartCanvas" width="600" height="400"></canvas>
    <p>See if you were right using the button below. If you have different data, your bar chart might look slightly different. </p>
    <button onclick="updateBarChart()">Update Graph</button>
  </section>

  <section class="experiment-section" id="feedback-box" style="max-width:700px; margin: 40px auto; text-align:center;">
    <h2>Share Your Feedback</h2>
    <div class="feedback-container">
      <div class="feedback-link-section">
        <p>Let us know what you thought of the experiment!</p>
        <a href="https://forms.office.com/e/E9LhHSvpH0" target="_blank">Feedback Form</a>
      </div>
      <div class="qr-section">
        <p>Scan to open our linktree and feedback form on your phone:</p>
        <img src="feedbackQR.png" alt="Feedback QR Code">
      </div>
    </div>
  </section>
  <footer>
  <div class="footer-logos">
    <a href="https://futuresnight.co.uk" target="_blank">
      <img src="futuresLogo.png" alt="Bristol Futures Logo" class="footer-logo">
    </a>
    <a href="https://www.bristol.ac.uk/composites/" target="_blank">
      <img src="BCI Logo.jpg" alt="University of Bristol Logo" class="footer-logo">
    </a>
    <a href="https://www.bcfc.co.uk/robins-foundation/" target="_blank">
      <img src="robinsFoundationLogo.png" alt="Robins Foundation Logo" class="footer-logo">
    </a>
    <a href="https://www.bristol.ac.uk/golding/" target="_blank">
      <img src="jgiLogo.svg" alt="Jean Golding Institute Logo" class="footer-logo">
    </a>
  </div>
  <p>2025 University of Bristol for Bristol Futures</p>
</footer>

<script>
  // Make functions globally accessible
  window.toggleDropdown = function(id) {
    const element = document.getElementById(id);
    if (element) {
      element.style.display = (element.style.display === 'none' || element.style.display === '') ? 'block' : 'none';
    }
  };

  window.addRow = function() {
    const tableBody = document.querySelector('#data-table tbody');
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
      <td>
        <select class="pressure-input">
          <option value="A">A: Soft</option>
          <option value="B">B: Hard</option>
        </select>
      </td>
      <td>
        <select class="surface-input">
          <option value="Hard Floor">Hard Floor</option>
          <option value="Astroturf">Astroturf</option>
          <option value="Grass">Grass</option>
          <option value="Carpet">Carpet</option>
          <option value="Concrete">Concrete</option>
        </select>
      </td>
      <td><input type="number" class="bounces-input" placeholder="Enter bounces"></td>
      <td><button type="button" class="delete-row-btn" onclick="deleteRow(this)" title="Delete row">&times;</button></td>
    `;
    tableBody.appendChild(newRow);
  };

  window.deleteRow = function(btn) {
    const row = btn.closest('tr');
    if (row) row.remove();
  };

  window.prePopulateData = function() {
    const tableBody = document.querySelector('#data-table tbody');
    // Clear existing rows
    tableBody.innerHTML = '';
    // Data to populate
    const data = [
      { inflation: 'A', surface: 'Hard Floor', bounces: 5 },
      { inflation: 'A', surface: 'Hard Floor', bounces: 6 },
      { inflation: 'A', surface: 'Astroturf', bounces: 3 },
      { inflation: 'A', surface: 'Astroturf', bounces: 4 },
      { inflation: 'B', surface: 'Hard Floor', bounces: 12 },
      { inflation: 'B', surface: 'Hard Floor', bounces: 13 },
      { inflation: 'B', surface: 'Astroturf', bounces: 8 },
      { inflation: 'B', surface: 'Astroturf', bounces: 9 }
    ];
    data.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <select class="pressure-input">
            <option value="A"${row.inflation === 'A' ? ' selected' : ''}>A: Soft</option>
            <option value="B"${row.inflation === 'B' ? ' selected' : ''}>B: Hard</option>
          </select>
        </td>
        <td>
          <select class="surface-input">
            <option value="Hard Floor"${row.surface === 'Hard Floor' ? ' selected' : ''}>Hard Floor</option>
            <option value="Astroturf"${row.surface === 'Astroturf' ? ' selected' : ''}>Astroturf</option>
            <option value="Grass"${row.surface === 'Grass' ? ' selected' : ''}>Grass</option>
            <option value="Carpet"${row.surface === 'Carpet' ? ' selected' : ''}>Carpet</option>
            <option value="Concrete"${row.surface === 'Concrete' ? ' selected' : ''}>Concrete</option>
          </select>
        </td>
        <td><input type="number" class="bounces-input" value="${row.bounces}" placeholder="Enter bounces"></td>
        <td><button type="button" class="delete-row-btn" onclick="deleteRow(this)" title="Delete row">&times;</button></td>
      `;
      tableBody.appendChild(tr);
    });
  };

  // Chart.js initialization for both charts
  // Line chart (graphCanvas)
  const canvas = document.getElementById('graphCanvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    window.chart = new Chart(ctx, {
      type: 'line',
      data: {
        datasets: []
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true }
        },
        scales: {
          x: {
            type: 'linear',
            title: {
              display: true,
              text: 'Pressure'
            },
            min: 0,
            max: 10,
            grid: {
              color: 'rgba(100,150,255,0.3)',
              lineWidth: 1,
              drawOnChartArea: true,
              drawTicks: true
            },
            ticks: {
              stepSize: 1,
              callback: function(value) {
                if (value === 2) return 'Soft';
                if (value === 7) return 'Hard';
                return '';
              }
            }
          },
          y: {
            title: {
              display: true,
              text: 'Number of Bounces'
            },
            beginAtZero: true,
            min: 0,
            max: 14,
            ticks: {
              stepSize: 1
            },
            grid: {
              color: 'rgba(100,150,255,0.3)',
              lineWidth: 1,
              drawOnChartArea: true,
              drawTicks: true
            }
          }
        }
      }
    });
  }

  // Bar chart (barChartCanvas)
  const barCanvas = document.getElementById('barChartCanvas');
  if (barCanvas) {
    const barCtx = barCanvas.getContext('2d');
    window.barChart = new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: ['Soft Ball', 'Hard Ball'],
        datasets: [{
          label: 'Number of Bounces',
          data: [0, 0],
          backgroundColor: ['#e63946', '#457b9d']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Ball Type'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Number of Bounces'
            },
            beginAtZero: true,
            min: 0,
            max: 14,
            ticks: {
              stepSize: 1
            }
          }
        }
      }
    });
  }

  // Update function for line chart
  window.updateGraph = function() {
    const categories = ["A", "B"];
    const pressureToX = { "A": 2, "B": 7 };
    const surfaces = ["Hard Floor", "Astroturf", "Grass", "Carpet", "Concrete"];
    const surfaceColors = {
      "Hard Floor": "blue",
      "Astroturf": "green",
      "Grass": "lime",
      "Carpet": "orange",
      "Concrete": "gray"
    };
    const pressureInputs = document.querySelectorAll('.pressure-input');
    const surfaceInputs = document.querySelectorAll('.surface-input');
    const bouncesInputs = document.querySelectorAll('.bounces-input');
    const surfaceData = {};
    surfaces.forEach(surface => { surfaceData[surface] = []; });
    const usedSurfaces = new Set();
    pressureInputs.forEach((input, index) => {
      const pressure = input.value;
      const surface = surfaceInputs[index].value;
      const bounce = parseFloat(bouncesInputs[index].value);
      if (categories.includes(pressure) && surfaces.includes(surface) && !isNaN(bounce)) {
        surfaceData[surface].push({ x: pressureToX[pressure], y: bounce });
        usedSurfaces.add(surface);
      }
    });
    const datasets = Array.from(usedSurfaces).map(surface => {
      const pointsByX = { 2: [], 7: [] };
      surfaceData[surface].forEach(pt => {
        if (pt.x === 2 || pt.x === 7) pointsByX[pt.x].push(pt.y);
      });
      const data = [];
      [2, 7].forEach(xVal => {
        if (pointsByX[xVal].length > 0) {
          const avg = pointsByX[xVal].reduce((a, b) => a + b, 0) / pointsByX[xVal].length;
          data.push({ x: xVal, y: avg });
        }
      });
      return {
        label: surface,
        data: data,
        borderColor: surfaceColors[surface],
        backgroundColor: surfaceColors[surface],
        borderWidth: 2,
        spanGaps: true,
        fill: false,
        showLine: true,
        pointRadius: 5
      };
    });
    if (window.chart) {
      window.chart.data.datasets = datasets;
      window.chart.update();
    }
  };

  // Update function for bar chart
  window.updateBarChart = function() {
    const pressureInputs = document.querySelectorAll('.pressure-input');
    const bouncesInputs = document.querySelectorAll('.bounces-input');
    let softBounces = [];
    let hardBounces = [];
    pressureInputs.forEach((input, idx) => {
      const bounce = parseFloat(bouncesInputs[idx].value);
      if (!isNaN(bounce)) {
        if (input.value === 'A') softBounces.push(bounce);
        if (input.value === 'B') hardBounces.push(bounce);
      }
    });
    const avgSoft = softBounces.length ? (softBounces.reduce((a,b)=>a+b,0)/softBounces.length) : 0;
    const avgHard = hardBounces.length ? (hardBounces.reduce((a,b)=>a+b,0)/hardBounces.length) : 0;
    if (window.barChart) {
      window.barChart.data.datasets[0].data = [avgSoft, avgHard];
      window.barChart.update();
    }
  };

  // Countdown timer logic with mm:ss display and reset-on-click
  window.startCountdown = function(btn) {
    // If a timer is already running, clear it and reset
    if (btn._interval) {
      clearInterval(btn._interval);
      btn._interval = null;
    }
    const originalText = btn.getAttribute('data-original-text') || btn.textContent;
    btn.setAttribute('data-original-text', originalText);

    let time = parseInt(btn.getAttribute('data-timer'), 10);
    btn.disabled = false; // Always allow clicking to reset

    function formatTime(secs) {
      const m = Math.floor(secs / 60).toString().padStart(2, '0');
      const s = (secs % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    btn.textContent = `Time left: ${formatTime(time)}`;

    btn._interval = setInterval(() => {
      time--;
      if (time > 0) {
        btn.textContent = `Time left: ${formatTime(time)}`;
      } else {
        clearInterval(btn._interval);
        btn._interval = null;
        btn.textContent = originalText;
      }
    }, 1000);
  };

  window.toggleExtensionTask = function() {
    const section = document.getElementById('extension-task-section');
    const btn = document.getElementById('show-extension-btn');
    if (section.style.display === 'none' || section.style.display === '') {
      section.style.display = 'block';
      btn.textContent = 'Hide Extension Task';
    } else {
      section.style.display = 'none';
      btn.textContent = 'Show Extension Task';
    }
  };

  // Only one updateBarChart function, updates the existing chart instance
  window.updateBarChart = function() {
    if (!window.barChart) return;
    // Gather data from table
    const pressureInputs = document.querySelectorAll('.pressure-input');
    const bouncesInputs = document.querySelectorAll('.bounces-input');
    let softBounces = [];
    let hardBounces = [];
    pressureInputs.forEach((input, idx) => {
      const bounce = parseFloat(bouncesInputs[idx].value);
      if (!isNaN(bounce)) {
        if (input.value === 'A') softBounces.push(bounce);
        if (input.value === 'B') hardBounces.push(bounce);
      }
    });
    // Calculate averages
    const avgSoft = softBounces.length ? (softBounces.reduce((a,b)=>a+b,0)/softBounces.length) : 0;
    const avgHard = hardBounces.length ? (hardBounces.reduce((a,b)=>a+b,0)/hardBounces.length) : 0;
    window.barChart.data.datasets[0].data = [avgSoft, avgHard];
    window.barChart.update();
  };
</script>
</body>
</html>