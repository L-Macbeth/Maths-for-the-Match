<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bounce Experiment</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script> <!-- Link to JavaScript for interactivity -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="timer.js"></script>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="usefullinks.html">Useful Links</a>
      <a href="experiment.html">Experiment</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <!-- Progress Stripe and Football Icon -->
  <div id="progress-stripe">
    <img id="football-icon" src="football-icon.png" alt="Football Icon">
  </div>

  <!-- Start Button below header, top left -->
  <button id="page-start-btn" style="margin: 30px auto 10px auto; display: block;">Start Session</button>

  <main>
    <h1>Experiment</h1>

    <!-- Introduction Section -->
    <section id="introduction">
      <h2>Introduction</h2>
      <p>This section introduces the experiment and provides context.</p>
      <img src="intro-image.jpg" alt="Introduction Image" />
      <h3>Experiment Outline</h3>
      <iframe src="https://www.youtube.com/embed/aFSdq4it8xg" title="Experiment Outline Video" allowfullscreen></iframe>
      <button onclick="toggleDropdown('script-intro')">Show Script</button>
      <div id="script-intro" class="dropdown-content" style="display: none;">
        <p>Hi Team, great to see you here. We have a problem, and I need your help investigating the solution. 
          The league is introducing a new type of football, and our players have been reporting that the inflation of their football is changing the way that they play. We need to work out what inflation does to the ball, and to help our players find a good amount of inflation for the big game. 

        In the home changing rooms you should find some balls that have been inflated, can you test which of them have the best bounce? 
        We also want to know if we can help our players out by playing on the astroturf or on a harder surface, can you investigate if this makes a difference?

        The drill for this experiment is, hold the ball out at chest level, drop it and count the number of bounces. 
        We’re looking for clean data, so throwing it at the ground is going to make it hard to see if we’re measuring the strength of your arms or the bounciness of the ball.
        We’re going for 5 reps of this drill on each of the inflated balls. Hold the ball out at chest level, drop it and count the number of bounces.

        The drill is going to require some teamwork. Someone to drop the ball, some team members to count the number of bounces and someone to write down the score. 
        Your class is going to work together with some of you bouncing the ball onto the changing room floor and some bouncing it on the astroturf.</p>
      </div>
      <p>Follow the steps below to conduct the experiment.</p>
    </section>

    <!-- Experiment Section -->
    <section id="experiment">
      <h2>Experiment</h2>
      <!-- Data Table -->
        <h3>Data Table</h3>
        <table id="data-table">
            <thead>
                <tr>
                    <th>Football Inflation</th>
                    <th>Surface</th>
                    <th>Number of Bounces</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                  <td>
                    <select class="pressure-input">
                      <option value="A">A: Soft</option>
                      <option value="B">B: Medium</option>
                      <option value="C">C: Hard</option>
                    </select>
                  </td>
                  <td>
                    <select class="surface-input">
                      <option value="Hard Floor">Hard Floor</option>
                      <option value="Astroturf">Astroturf</option>
                      <option value="Grass">Grass</option>
                      <option value="Carpet">Carpet</option>
                      <option value="Concrete">Concrete</option>
                    </select>
                  </td>
                  <td><input type="number" class="bounces-input" placeholder="Enter bounces"></td>
                  <td><button type="button" class="delete-row-btn" onclick="deleteRow(this)" title="Delete row">&times;</button></td>
                </tr>
                <!-- Add more rows as needed -->
            </tbody>
        </table>
        <button onclick="addRow()">Add Row</button>
        <button onclick="updateGraph()">Update Graph</button>

        <!-- Graph -->
        <h3>Graph</h3>
        <canvas id="graphCanvas" width="600" height="400"></canvas>
    </section>

    <!-- Theory Outline Section -->
    <section id="theory-outline">
      <h2>Theory Outline</h2>
      <iframe src="https://www.youtube.com/embed/example-theory-video" title="Theory Outline Video" allowfullscreen></iframe>
      <button onclick="toggleDropdown('script-theory')">Show Script</button>
      <div id="script-theory" class="dropdown-content" style="display: none;">
        <p>This is the script for the theory video.</p>
      </div>
      <p>Here is a description of the theory with diagrams and animations:</p>
      <img src="theory-diagram.jpg" alt="Theory Diagram" />
    </section>

    <!-- Conclusions Questions Section -->
    <section id="conclusions-questions">
      <h2>Questions and Conclusions</h2>
      <div>
        <p>How does the inflation of the ball effect the number of bounces? Which ball would be best to score a penalty with?</p>
        <button onclick="toggleDropdown('answer1')">Show Answer</button>
        <div id="answer1" class="dropdown-content" style="display: none;">
          <p>We found that the less air a ball has inside it, the fewer times it bounces. 
            This is because a ball with less air is softer and changes shape more easily, which means it loses more energy when it hits the ground.
            We also noticed that there’s a big difference in how the ball bounces when it goes from no air to some air. 
            But when you go from a medium amount of air to a lot of air, the difference in bounces isn’t as big.
            If you were trying to score a penalty, the best ball to use would be the one with the most air in it. 
            This is because a harder ball doesn’t change shape as much, so more of the energy from your kick goes into making the ball move forward instead of being lost.</p>
        </div>
      </div>
      <div>
        <p>Sketch what happens to the ball when it hits the ground. Why do you think this happens?</p>
        <button onclick="toggleDropdown('answer2')">Show Answer</button>
        <div id="answer2" class="dropdown-content" style="display: none;">
          <img src="BouncingPhysics.svg" alt="Diagram describing the motion of the bouncing ball." style="max-width: 100%; height: auto;">
        </div>
      </div>
      <div>
        <p>Why do you think the surface changes how much the ball bounces? What surface do you think the team should play on?</p>
        <button onclick="toggleDropdown('answer3')">Show Answer</button>
        <div id="answer3" class="dropdown-content" style="display: none;">
          <p>The surface changes how much the ball bounces because a softer surface absorbs more energy from the ball when it hits the ground. 
            This means that less energy is available to make the ball bounce back up. 
            The team should play on a harder surface, like the changing room floor, because it will give the ball more bounce and help them score more goals.</p>
        </div>
      </div>
      <div>
        <p>What would happen if you threw the ball?</p>
        <button onclick="toggleDropdown('answer4')">Show Answer</button>
        <div id="answer4" class="dropdown-content" style="display: none;">
          <p>Throwing the ball would give the ball more energy, we would expect it to bounce higher and for longer. 
            This is why having more energy in a kick is important for a footballer.</p>
        </div>
      </div>

      <!-- Interview video and script -->
      <div>
        <iframe src="https://www.youtube.com/embed/YOUR_INTERVIEW_VIDEO_ID" title="Interview Video" allowfullscreen></iframe>
        <button onclick="toggleDropdown('script-interview')">Show Script</button>
        <div id="script-interview" class="dropdown-content" style="display: none;">
          <p>Look, the team left everything out there today. They worked incredibly hard to gather this data, and in the end, that effort really paid off. 
            What we’ve found is that there’s definitely a relationship between the ball’s pressure and how many times it bounces. On top of that, the surface it hits also plays a huge role in how the ball behaves.

          Think of it like this: when we drop the ball onto a hard surface, it starts with gravitational potential energy – just from being held up. 
          As soon as you let it go, gravity takes over, and that energy shifts to kinetic energy because the ball is now moving.

          Then, you’ve got the first impact. The ball hits the ground and deforms slightly – that’s where we see some of that kinetic energy converting into elastic potential energy. 
          The ball compresses, wants to snap back to shape, and that’s when the rebound happens. Not all of the energy makes it into that bounce though – some of it is lost as sound (which we hear), some as heat, and some goes into permanently deforming the ball – which is why, over time, balls wear out.

          Now as the ball comes back up, it's working against gravity again, and eventually it’ll come back down for another bounce. 
          But it won’t bounce forever – energy losses to heat, sound, and deformation mean each bounce is a little lower.

          When you switch to a softer surface, the story changes. 
          The ground deforms as well, meaning more energy is absorbed, and the ball doesn’t bounce as much. 
          Same goes for a ball with lower pressure – it deforms more easily, so again, fewer bounces.

          It’s a great insight for the squad – not just about physics, but about the importance of pressure and conditions. 
          We’ll definitely be taking this into account moving forward.</p>
      </div>
    </section>

    <!-- Conclusions Section -->
    <section id="conclusions">
      <h2>Conclusions</h2>
      <iframe src="https://www.youtube.com/embed/example-conclusion-video" title="Conclusions Video" allowfullscreen></iframe>
      <button onclick="toggleDropdown('script-conclusion')">Show Script</button>
      <div id="script-conclusion" class="dropdown-content" style="display: none;">
        <p>This is the script for the conclusions video.</p>
      </div>
    </section>

    <!-- Timer Panel Section -->
    <div id="timer-panel">
      <h3>Session Timer</h3>
      <div id="timer-step-list"></div>
      <div id="timer-controls">
        <button id="timer-prev">Previous</button>
        <button id="timer-start">Start</button>
        <button id="timer-pause">Pause</button>
        <button id="timer-next">Next</button>
      </div>
      <div id="timer-current">
        <h4 id="timer-label"></h4>
        <p id="timer-desc"></p>
        <div id="timer-display">00:00</div>
      </div>
    </div>
  </main>
  <footer>
    <p>&copy; 2025 Robins Foundation Outreach</p>
  </footer>

  <script>
    // JavaScript function to toggle dropdown visibility
    function toggleDropdown(id) {
      const element = document.getElementById(id);
      element.style.display = element.style.display === 'none' ? 'block' : 'none';
    }
    
    // Function to add a new row to the data table
    function addRow() {
      const tableBody = document.querySelector('#data-table tbody');
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>
          <select class="pressure-input">
            <option value="A">A: Soft</option>
            <option value="B">B: Medium</option>
            <option value="C">C: Hard</option>
          </select>
        </td>
        <td>
          <select class="surface-input">
            <option value="Hard Floor">Hard Floor</option>
            <option value="Astroturf">Astroturf</option>
            <option value="Grass">Grass</option>
            <option value="Carpet">Carpet</option>
            <option value="Concrete">Concrete</option>
          </select>
        </td>
        <td><input type="number" class="bounces-input" placeholder="Enter bounces"></td>
        <td><button type="button" class="delete-row-btn" onclick="deleteRow(this)" title="Delete row">&times;</button></td>
      `;
      tableBody.appendChild(newRow);
    }
    
    // Function to delete a row from the data table
    function deleteRow(btn) {
      const row = btn.closest('tr');
      row.remove();
    }
    
    // Initialize the Chart.js graph
    const ctx = document.getElementById('graphCanvas').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ["Soft", "Medium", "Hard"], // X-axis: Pressure
        datasets: [] // Will be filled dynamically
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: true
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Pressure'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Number of Bounces'
            },
            beginAtZero: true
          }
        }
      }
    });
  
    // Function to update the graph based on table input
    function updateGraph() {
      const categories = ["A", "B", "C"];
      const categoryLabels = {
        "A": "Soft",
        "B": "Medium",
        "C": "Hard"
      };
      const surfaces = ["Hard Floor", "Astroturf", "Grass", "Carpet", "Concrete"];
      const surfaceColors = {
        "Hard Floor": "blue",
        "Astroturf": "green",
        "Grass": "lime",
        "Carpet": "orange",
        "Concrete": "gray"
      };

      const pressureInputs = document.querySelectorAll('.pressure-input');
      const surfaceInputs = document.querySelectorAll('.surface-input');
      const bouncesInputs = document.querySelectorAll('.bounces-input');

      // Prepare data structure: surface -> pressure -> [bounces]
      const bounceData = {};
      surfaces.forEach(surface => {
        bounceData[surface] = { "A": [], "B": [], "C": [] };
      });

      pressureInputs.forEach((input, index) => {
        const pressure = input.value;
        const surface = surfaceInputs[index].value;
        const bounce = parseFloat(bouncesInputs[index].value);
        if (categories.includes(pressure) && surfaces.includes(surface) && !isNaN(bounce)) {
          bounceData[surface][pressure].push(bounce);
        }
      });

      // Build datasets for each surface
      const datasets = surfaces.map(surface => {
        const data = categories.map(cat => {
          const arr = bounceData[surface][cat];
          if (arr.length === 0) return null;
          return arr.reduce((a, b) => a + b, 0) / arr.length;
        });
        return {
          label: surface,
          data: data,
          borderColor: surfaceColors[surface],
          backgroundColor: surfaceColors[surface],
          borderWidth: 2,
          spanGaps: true,
          fill: false
        };
      });

      chart.data.labels = categories.map(cat => categoryLabels[cat]);
      chart.data.datasets = datasets;
      chart.update();
    }

    let timerIndex = 0;
    let timerInterval = null;
    let timerRemaining = 0;

    function renderTimerSteps() {
      const list = document.getElementById('timer-step-list');
      list.innerHTML = '';
      window.timerSteps.forEach((step, i) => {
        const btn = document.createElement('button');
        btn.textContent = `${step.label} (${step.duration ? Math.floor(step.duration/60) + 'm' : '0m'})`;
        btn.className = (i === timerIndex) ? 'active' : '';
        btn.onclick = () => selectTimerStep(i);
        list.appendChild(btn);
      });
    }

    function selectTimerStep(i) {
      timerIndex = i;
      timerRemaining = window.timerSteps[i].duration;
      updateTimerDisplay();
      renderTimerSteps();
      pauseTimer();
    }

    function updateTimerDisplay() {
      const step = window.timerSteps[timerIndex];
      document.getElementById('timer-label').textContent = step.label;
      document.getElementById('timer-desc').textContent = step.description;
      const min = Math.floor(timerRemaining / 60).toString().padStart(2, '0');
      const sec = (timerRemaining % 60).toString().padStart(2, '0');
      document.getElementById('timer-display').textContent = `${min}:${sec}`;
    }

    function startTimer() {
      if (timerInterval) return;
      timerInterval = setInterval(() => {
        if (timerRemaining > 0) {
          timerRemaining--;
          updateTimerDisplay();
        } else {
          pauseTimer();
          // Optionally auto-advance to next step
          // nextTimerStep();
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function nextTimerStep() {
      if (timerIndex < window.timerSteps.length - 1) {
        selectTimerStep(timerIndex + 1);
      }
    }
    function prevTimerStep() {
      if (timerIndex > 0) {
        selectTimerStep(timerIndex - 1);
      }
    }

    document.getElementById('timer-start').onclick = startTimer;
    document.getElementById('timer-pause').onclick = pauseTimer;
    document.getElementById('timer-next').onclick = nextTimerStep;
    document.getElementById('timer-prev').onclick = prevTimerStep;

    // Initialize
    selectTimerStep(0);
    renderTimerSteps();

    // Section anchors for each main activity (add these IDs to your sections as shown below)
    const sectionIds = [
      "introduction",
      "experiment",
      "theory-outline",
      "conclusions-questions",
      "conclusions"
    ];

    // Move football icon to the current section
    function moveFootballToSection(index) {
      const icon = document.getElementById('football-icon');
      const section = document.getElementById(sectionIds[index]);
      if (section) {
        const rect = section.getBoundingClientRect();
        const scrollTop = window.scrollY || document.documentElement.scrollTop;
        // Offset so the icon is vertically centered with the section
        const top = rect.top + scrollTop + rect.height / 2 - 24; // 24 = half icon height
        icon.style.top = `${top}px`;
      }
    }

    // When timer step changes, move the football
    function updateFootballPositionForTimer() {
      // Map timerIndex to section index (customize if needed)
      let sectionIdx = Math.min(timerIndex, sectionIds.length - 1);
      moveFootballToSection(sectionIdx);
    }

    // Hook into your timer step selection
    const originalSelectTimerStep = selectTimerStep;
    selectTimerStep = function(i) {
      originalSelectTimerStep(i);
      updateFootballPositionForTimer();
    };

    // Start button scrolls to first section and moves football
    document.getElementById('page-start-btn').onclick = function() {
      document.getElementById(sectionIds[0]).scrollIntoView({behavior: "smooth"});
      selectTimerStep(0);
      updateFootballPositionForTimer();
    };

    // On page load, position football at the first section
    window.addEventListener('DOMContentLoaded', () => {
      updateFootballPositionForTimer();
    });

    // Also reposition on window resize/scroll
    window.addEventListener('resize', updateFootballPositionForTimer);
    window.addEventListener('scroll', updateFootballPositionForTimer);
  </script>
</body>
</html>